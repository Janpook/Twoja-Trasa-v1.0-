<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ulubione - TwojaTrasa.online</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="icon" type="image/png" href="favicons.png" onerror="this.onerror=null; this.href='https://img.icons8.com/ios-filled/50/000000/bus-stop.png';">
    <style>
	
	        /* --- Opcja 2: Logo z ikoną pinezki --- */
        .logo-option-2 {
            display: flex; /* Ustawia ikonę i tekst w jednej linii */
            align-items: center; /* Wyśrodkowuje ikonę i tekst pionowo */
        }

        .logo-option-2 .logo-icon {
            margin-right: 8px; /* Odstęp między ikoną a tekstem */
            font-size: 1.2em; /* Lekko powiększona ikona */
            color: var(--accent); /* Kolor ikony dopasowany do akcentu */
            line-height: 1; /* Zapobiega problemom z wysokością linii */
        }

        /* Zachowujemy oryginalne podświetlenie 'Trasa' */
        .logo-option-2 span {
           color: var(--accent);
        }
        /* --- Koniec Opcji 2 --- */
        /* --- SKOPIOWANY CAŁY BLOK CSS Z INDEX.HTML (Minimalistyczny / Dark / MPK) --- */
        :root {
            --bg-primary: #1a1a1a; --bg-secondary: #262626; --bg-tertiary: #333333;
            --text-primary: #e0e0e0; --text-secondary: #9e9e9e; --text-tertiary: #6b6b6b;
            --accent: #99cc00; --accent-hover: #88bb00; --accent-yellow: #ffdd00;
            --text-on-accent: #1a1a1a; --border-color: #404040; --shadow-color: rgba(0, 0, 0, 0.2);
            --font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Open Sans", "Helvetica Neue", sans-serif;
            --font-size-base: 14px; --font-size-small: 12px; --font-size-large: 16px;
            --border-radius: 4px; --transition: all 0.2s ease-in-out;
        }
        body[data-theme="light"] {
            --bg-primary: #ffffff; --bg-secondary: #f5f5f5; --bg-tertiary: #eeeeee;
            --text-primary: #212121; --text-secondary: #757575; --text-tertiary: #bdbdbd;
            --accent: #77aa00; --accent-hover: #669900; --accent-yellow: #ffcc00;
            --text-on-accent: #ffffff; --border-color: #e0e0e0; --shadow-color: rgba(0, 0, 0, 0.1);
        }
        *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
        body { font-family: var(--font-family); font-size: var(--font-size-base); background-color: var(--bg-primary); color: var(--text-primary); line-height: 1.6; transition: var(--transition); padding-top: 55px; /* Miejsce na top-bar */ }
        a { color: var(--accent); text-decoration: none; transition: var(--transition); }
        a:hover { color: var(--accent-hover); text-decoration: underline; }
        button { font-family: inherit; font-size: inherit; cursor: pointer; border: none; background: none; color: inherit; }
        ul, ol { list-style: none; }
        .top-bar { position: fixed; top: 0; left: 0; width: 100%; height: 55px; background-color: var(--bg-secondary); border-bottom: 1px solid var(--border-color); display: flex; align-items: center; justify-content: space-between; padding: 0 15px; z-index: 1000; transition: var(--transition); }
        .top-bar .logo { font-size: var(--font-size-large); font-weight: 600; color: var(--text-primary); }
        .top-bar .logo span { color: var(--accent); }
        .top-bar .back-link { color: var(--accent); text-decoration: none; font-size: var(--font-size-base); transition: var(--transition); display: flex; align-items: center; gap: 5px; }
        .top-bar .back-link:hover { color: var(--accent-hover); }

        /* --- Główny kontener dla podstron --- */
        .container { max-width: 900px; margin: 20px auto; padding: 20px; }

        /* --- Style specyficzne dla favorites.html --- */
         .container h1 { font-size: calc(var(--font-size-large) + 4px); font-weight: 600; margin-bottom: 30px; color: var(--text-primary); display: flex; align-items: center; gap: 10px; border-bottom: 1px solid var(--border-color); padding-bottom: 15px; }
         .container h1 i { color: var(--accent-yellow); } /* Żółta gwiazdka w tytule */

         h3 {
             font-size: var(--font-size-large);
             margin: 30px 0 15px;
             color: var(--text-secondary);
             border-bottom: 1px solid var(--border-color);
             padding-bottom: 8px;
             transition: var(--transition);
             font-weight: 500;
             display: flex;
             align-items: center;
             gap: 8px;
         }
         h3 i { color: var(--accent); }

         ul { list-style: none; padding: 0; }
         li.favorite-item { /* Zmieniono klasę dla jasności */
            padding: 12px 15px;
            background: var(--bg-secondary);
            margin-bottom: 8px;
            border-radius: var(--border-radius);
            display: flex;
            flex-wrap: wrap;
            justify-content: space-between;
            align-items: center;
            transition: var(--transition);
            border: 1px solid var(--border-color);
         }
         li.favorite-item:hover { background-color: var(--bg-tertiary); border-color: var(--accent); }
         li.favorite-item > span:first-child { /* Główny tekst wyniku */
            flex-grow: 1;
            margin-right: 15px;
            display: flex;
            align-items: center;
            gap: 8px;
         }
          li.favorite-item > span:first-child .icon { /* Styl ikony przy wyniku */
             color: var(--text-secondary);
             font-size: 1.1em;
             width: 1.2em;
             text-align: center;
         }
         .result-links { /* Używamy tej samej klasy co w search.html */
             flex-shrink: 0;
             display: flex;
             gap: 15px;
             align-items: center;
         }
         .result-links a {
             color: var(--accent);
             text-decoration: none;
             font-size: var(--font-size-small);
             white-space: nowrap;
             display: inline-flex;
             align-items: center;
             gap: 4px;
             padding: 4px 8px;
             border-radius: var(--border-radius);
         }
         .result-links a:hover {
             color: var(--accent-hover);
             background-color: var(--bg-primary);
             text-decoration: none;
         }
         /* Styl dla braku ulubionych */
         p.no-favorites { /* Zmieniono ID na klasę */
             padding: 15px;
             color: var(--text-secondary);
             text-align: center;
             font-style: italic;
             background: none;
             border: 1px dashed var(--border-color);
             border-radius: var(--border-radius);
             margin-top: 10px;
         }

         /* Media Queries */
         @media (max-width: 768px) {
            :root { --font-size-base: 13px; --font-size-small: 11px; --font-size-large: 15px; }
            .top-bar { height: 50px; padding: 0 10px; }
            .top-bar .logo { font-size: 18px; }
            .top-bar .back-link { font-size: var(--font-size-base); }
            body { padding-top: 50px; }
            .container { margin: 15px; padding: 15px; }
            .container h1 { font-size: 18px; padding-bottom: 10px; margin-bottom: 20px; }
            h3 { font-size: var(--font-size-large); margin-top: 25px; }
            li.favorite-item { padding: 10px; flex-direction: column; align-items: flex-start; gap: 8px; }
            .result-links { margin-top: 8px; width: 100%; justify-content: flex-start; gap: 15px; }
            .result-links a { padding: 6px 10px; }
        }
    </style>
</head>
<body data-theme="dark">
    <div class="top-bar">
		<div class="logo logo-option-2">
			<i class="fas fa-map-marker-alt logo-icon"></i> Twoja<span> Trasa</span>
		</div>
        <div class="nav-links"> <a href="index.html" class="back-link"><i class="fas fa-arrow-left"></i> Mapa</a>
            <a href="menu.html" class="back-link"><i class="fas fa-bars"></i> Menu</a> </div>
    </div>

    <div class="container">
        <h1><i class="fas fa-star"></i> Ulubione</h1>

        <div id="favoritesList">
            <h3><i class="fas fa-bus"></i> Pojazdy</h3>
            <ul id="favoriteVehicles"></ul>
            <p id="noFavoriteVehicles" class="no-favorites" style="display: none;">Brak ulubionych pojazdów.</p>

            <h3><i class="fas fa-map-pin"></i> Przystanki</h3>
            <ul id="favoriteStops"></ul>
            <p id="noFavoriteStops" class="no-favorites" style="display: none;">Brak ulubionych przystanków.</p>

            <!-- Nowa sekcja dla ulubionych tras -->
            <h3><i class="fas fa-route"></i> Trasy</h3>
            <ul id="favoriteRoutes"></ul>
            <p id="noFavoriteRoutes" class="no-favorites" style="display: none;">Brak ulubionych tras.</p>
        </div>
    </div>

    <script>
        function applyTheme(theme) { document.body.setAttribute('data-theme', theme); }
        document.addEventListener('DOMContentLoaded', () => {
            let currentTheme = 'dark';
            try {
                const savedTheme = localStorage.getItem('theme');
                if (savedTheme === 'dark' || savedTheme === 'light') {
                    currentTheme = savedTheme;
                }
            } catch (e) {}
            applyTheme(currentTheme);

            const favorites = JSON.parse(localStorage.getItem('favorites')) || { vehicles: [], stops: [] };
            const favoriteRoutes = JSON.parse(localStorage.getItem('favoriteRoutes')) || [];

            console.log('Ulubione trasy:', JSON.parse(localStorage.getItem('favoriteRoutes')));

            const favVehiclesList = document.getElementById('favoriteVehicles');
            const noFavVehicles = document.getElementById('noFavoriteVehicles');
            const favStopsList = document.getElementById('favoriteStops');
            const noFavStops = document.getElementById('noFavoriteStops');
            const favRoutesList = document.getElementById('favoriteRoutes');
            const noFavRoutes = document.getElementById('noFavoriteRoutes');

            // Obsługa ulubionych pojazdów
            if (favorites.vehicles.length === 0) {
                noFavVehicles.style.display = 'block';
            } else {
                favVehiclesList.innerHTML = favorites.vehicles.map(v => `
                    <li class="favorite-item">
                        <span><span class="icon"><i class="fas fa-bus"></i></span> Nr <strong>${v.taborNumber}</strong> (L: ${v.line}, kier.: ${v.destination})</span>
                        <div class="result-links">
                            <a href="index.html?pojazd=${v.taborNumber}" title="Pokaż GPS"><i class="fas fa-map-marker-alt"></i> GPS</a>
                        </div>
                    </li>`).join('');
            }

            // Obsługa ulubionych przystanków
            if (favorites.stops.length === 0) {
                noFavStops.style.display = 'block';
            } else {
                favStopsList.innerHTML = favorites.stops.map(s => `
                    <li class="favorite-item">
                        <span><span class="icon"><i class="fas fa-map-pin"></i></span> ${s.name} (ID: ${s.stopId}${s.code ? ', Kod: '+s.code : ''})</span>
                        <div class="result-links">
                             <a href="index.html?przystanek=${s.stopId}" title="Pokaż na mapie"><i class="fas fa-map-marked-alt"></i> Mapa</a>
                        </div>
                    </li>`).join('');
            }

            // Obsługa ulubionych tras
            if (favoriteRoutes.length === 0) {
                noFavRoutes.style.display = 'block';
            } else {
                favRoutesList.innerHTML = favoriteRoutes.map(route => {
                    const vehicleCount = countVehiclesOnRoute(route.routeId); // Pobierz liczbę pojazdów na trasie
                    return `
                        <li class="favorite-item">
                            <span>
                                <span class="icon"><i class="fas fa-route"></i></span>
                                Trasa: <strong>${route.routeId}</strong> 
                                <span style="color: var(--text-secondary); font-size: 0.9em;">Pojazdy: ${vehicleCount}</span>
                            </span>
                            <div class="result-links">
                                <a href="#" onclick="removeFavoriteRoute('${route.routeKey}'); return false;" title="Usuń z ulubionych"><i class="fas fa-trash"></i> Usuń</a>
                            </div>
                        </li>`;
                }).join('');
            }
        });

        // Funkcja licząca pojazdy na trasie
        function countVehiclesOnRoute(routeId) {
            if (!window.vehicleData || !(window.vehicleData instanceof Map)) return 0;
            let count = 0;

            window.vehicleData.forEach(vehicle => {
                if (vehicle.trip?.routeId === routeId) {
                    count++;
                }
            });

            return count;
        }

        // Funkcja usuwająca trasę z ulubionych
        function removeFavoriteRoute(routeKey) {
            const favoriteRoutes = JSON.parse(localStorage.getItem('favoriteRoutes')) || [];
            const updatedRoutes = favoriteRoutes.filter(route => route.routeKey !== routeKey);
            localStorage.setItem('favoriteRoutes', JSON.stringify(updatedRoutes));
            location.reload(); // Odśwież stronę, aby zaktualizować listę
        }
    </script>
</body>
</html>